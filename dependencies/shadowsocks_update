#!/bin/sh
#Update Shadowsocks-libev static
cd shadowsocks-libev
make distclean
git fetch
git reset --hard origin/master
git submodule update --init --recursive
./autogen.sh
CFLAGS="$CFLAGS -I${WORKDIRECTORY}/include" LDFLAGS="$LDFLAGS -L${WORKDIRECTORY}/lib --static" ./configure --prefix=$WORKDIRECTORY --disable-shared --disable-silent-rules && make -j$CPU_NUM
make install

if [ $SUDO = yes ]; then
  $UNENCRYTEDPASSWD
  echo $PASSWD | sudo -SE setcap cap_net_bind_service+ep $WORKDIRECTORY/bin/ss-server
  $ENCRYTEDPASSWD
elif [ $SUDO = no ]; then
  setcap cap_net_bind_service+ep $WORKDIRECTORY/bin/ss-server
fi

cd ..
