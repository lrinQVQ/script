#!/bin/sh
#Shadowsocks-libev static
echo "$MSG_SS"

git clone --recursive https://github.com/shadowsocks/shadowsocks-libev.git
cd shadowsocks-libev
./autogen.sh
CFLAGS="$CFLAGS -I${WORKDIRECTORY}/include" LDFLAGS="$LDFLAGS -L${WORKDIRECTORY}/lib --static" ./configure --prefix=$WORKDIRECTORY --disable-shared --disable-silent-rules && make -j$CPU_NUM
make install

if [ "$SUDO" = "yes" ]; then
  $UNENCRYTEDPASSWD
  echo $PASSWD | sudo -SE setcap cap_net_bind_service+ep $WORKDIRECTORY/bin/ss-server
  $ENCRYTEDPASSWD
elif [ "$SUDO" = "no" ]; then
  setcap cap_net_bind_service+ep $WORKDIRECTORY/bin/ss-server
fi

cd ..
